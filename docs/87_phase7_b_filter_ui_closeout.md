# 87 — Phase7-B 履歴フィルタ UI クローズアウト

**Phase7-B MVP（履歴の type / node_id フィルタ UI）を「完了」として正式にクローズする。**

**参照**: 84_phase7_b_scope.md、85_phase7_b_filter_ui_plan.md、86_phase7_b_filter_ui_e2e_result.md。

---

## 1. 完了宣言

- **Phase7-B MVP（履歴フィルタ UI）はクローズした。**
- Organizer タブの「適用済み Diff 履歴」ブロックに、種別セレクトと node_id 入力欄・絞り込む/クリアボタンを追加した。API は既存の GET /api/confirmations/history を利用し、フロントのみの変更で完結している。

---

## 2. できるようになったこと

| 項目 | 内容 |
|------|------|
| **UI で type フィルタ** | 種別セレクト（すべて / 関連 / グループ化 / 分解）で履歴を絞り込める。「絞り込む」押下で API に type クエリを付与して再取得する。 |
| **UI で node_id フィルタ** | node_id 入力欄に UUID を入力し「絞り込む」で、その Node に関係する履歴のみ表示する。 |
| **バリデーション** | node_id が不正な場合（UUID 形式でない場合）は API を呼ばず、入力欄付近に「UUID形式ではありません」を表示する。 |
| **クリア** | 「クリア」ボタンで種別・node_id をリセットし、フィルタなしで履歴を再取得する。 |
| **0 件表示** | フィルタ適用結果が 0 件のとき「該当する履歴がありません」と表示する。フィルタなしで 0 件のときは従来どおり「Apply 済みの Diff はまだありません」。 |

---

## 3. DoD 確認表

| # | 確認項目（85 §4 相当） | 結果 |
|---|------------------------|------|
| 1 | 種別を変更すると履歴がその種別で絞り込まれて表示される | ✅ |
| 2 | node_id に有効な UUID を入力し「絞り込む」で絞り込まれる | ✅ |
| 3 | フィルタ結果 0 件のとき空表示が正しく出る | ✅ |
| 4 | Apply 成功後、リロードなしで履歴が増える挙動が壊れていない | ✅ |
| 5 | Phase6 ツリー表示が壊れていない | ✅ |

---

## 4. MVP の割り切り

以下は Phase7-B の範囲外であり、クローズ時点で未対応である。既存方針に合わせる。

| 項目 | 内容 |
|------|------|
| **ページネーション** | 「さらに読み込む」等は行わない。limit=50 で取得した分のみ表示。 |
| **ツリー連携** | 履歴 1 件選択時に該当 Node をツリー/詳細でフォーカスする機能は行わない。 |
| **reason** | 履歴詳細に reason を表示する機能は行わない。保存・表示は別テーマ。 |
| **onChange での自動取得** | 種別変更や node_id 入力のたびに API を呼ばない。MVP は「絞り込む」ボタン押下で取得。 |

---

## 5. 次フェーズへの引き継ぎ候補

| 候補 | 内容 |
|------|------|
| **ページネーション UI** | 履歴が多数の場合の「さらに読み込む」や offset 指定。API の limit/offset は対応済み。 |
| **履歴→ツリー連携** | 履歴 1 件選択時に該当 Node をダッシュボードのツリーまたは詳細パネルで表示する。 |
| **reason 保存・表示** | Confirm 時に reason を proposed_change に含めて保存し、履歴詳細で表示する。 |
| **フィルタの自動適用** | 種別変更時や node_id 入力確定時（onBlur 等）に自動で再取得するオプション。 |

---

## 6. 参照ドキュメント

| 番号 | ファイル名 |
|------|------------|
| 84 | 84_phase7_b_scope.md |
| 85 | 85_phase7_b_filter_ui_plan.md |
| 86 | 86_phase7_b_filter_ui_e2e_result.md |

---

以上をもって Phase7-B 履歴フィルタ UI MVP をクローズする。
