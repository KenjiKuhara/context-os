# 103 — Phase10-A ノード詳細に関連する直近履歴 1 件表示 手動 E2E 計画

Phase10-A（ノード詳細に関連する直近履歴 1 件表示）を手動 E2E で検証するための計画。DoD チェックリストと既存挙動の非破壊確認を整理する。

**参照**: 102_phase10_a_related_recent_history_design.md、[src/app/dashboard/page.tsx](src/app/dashboard/page.tsx)。

---

## 1. 対象

Phase10-A で追加した以下を手動 E2E で確認する。DB・API 変更は行っていない。

| 項目 | 内容 |
|------|------|
| **関連する直近履歴ブロック** | 右の詳細パネルで、選択中ノードに関係する適用済み履歴の直近 1 件を表示する。種別・日時・要約・理由（あれば）を表示する。 |
| **エッジケース表示** | 履歴 0 件時は「該当する履歴はありません」、取得中は「取得中…」、取得失敗時は「取得できませんでした」を表示する。 |

---

## 2. DoD（手動 E2E チェックリスト）

| # | 確認項目 | 手順 | 期待結果 |
|---|----------|------|----------|
| 1 | **ノード選択でブロックが表示される** | 左の一覧またはツリーでノードを 1 つ選択する。 | 右の詳細パネルに「関連する直近履歴」ブロックが表示される。ノード基本情報（タイトル・状態・更新等）の下、Result message や「何が起きた？」の上に配置されている。 |
| 2 | **履歴 1 件以上あるノードで直近 1 件が表示される** | 該当ノードに関係する適用済み履歴（relation / grouping / decomposition）が 1 件以上存在するノードを選択する。 | ブロック内に直近 1 件の種別（関係追加／グループ化／分解）、日時、要約 1 行が表示される。その履歴に reason が保存されていれば「理由: …」も表示される。 |
| 3 | **履歴 0 件のノードで 0 件メッセージが表示される** | 該当ノードに関係する適用済み履歴が 0 件のノードを選択する（またはまだ 1 件も Apply していないノード）。 | ブロック内に「該当する履歴はありません」が表示される。 |
| 4 | **取得中・取得失敗の表示** | ノードを切り替えた直後は一瞬「取得中…」が出る場合がある。取得失敗は API 異常時のみ。 | 取得中は「取得中…」、API が ok: false やネットワークエラーとなった場合は「取得できませんでした」等の短いメッセージがブロック内に表示される。 |
| 5 | **既存挙動に影響しない** | 履歴タブの一覧・詳細・フィルタ・復元・履歴クリック時のツリー連動、Organizer の Apply、復元からの Apply、ツリーの開閉・詳細選択を行う。 | いずれも従来どおり動作する。詳細パネルの他ブロック（状態・何が起きた？・推定結果）も壊れていない。 |

---

## 3. 影響なし確認（既存挙動非破壊）

手動 E2E で以下を簡易確認する。

| 項目 | 確認内容 | 期待結果 |
|------|----------|----------|
| **履歴タブ** | Organizer タブの「適用済み Diff 履歴」の一覧・詳細表示・種別／node_id フィルタ・「この変更内容をApply候補として再表示する」で復元する。 | 従来どおり動作する。Phase10-A は詳細パネルの 1 ブロック追加のみで、履歴タブは変更していない。 |
| **Apply** | Organizer の適用可能 Diff から「このDiffを反映する」で Apply する。 | 従来どおり成功する。 |
| **復元→Apply** | 履歴から 1 件を復元し、復元カードの「このDiffを反映する」で Apply する。 | 従来どおり成功する。 |
| **ツリー** | /dashboard でツリー表示の開閉・キーボード操作・ノード選択で詳細表示する。履歴 1 件をクリックしたときのツリー展開・ハイライト・詳細表示（Phase9-A）も行う。 | 従来どおり動作する。 |

---

## 4. 本 MVP で行わないこと（割り切り）

以下は Phase10-A の範囲外であり、一切行わない。（102 §9 を踏襲）

| 項目 | 内容 |
|------|------|
| **複数件表示・ページネーション** | 直近 1 件のみ表示する。2 件目以降の表示や「さらに読み込む」は行わない。 |
| **クリックで履歴タブへ遷移** | 関連履歴ブロックをクリックして履歴タブにフォーカスする導線は追加しない。 |
| **履歴タブの変更** | 履歴一覧・詳細・フィルタ・復元・Phase9-A の履歴→ツリー連動は一切変更しない。 |
| **Observer 連携** | Observer の表示や連携は Phase10-A の範囲外とする。 |

---

## 5. 参照ドキュメント

| 番号 | ファイル名 |
|------|------------|
| 102 | 102_phase10_a_related_recent_history_design.md |

---

以上。Phase10-A ノード詳細に関連する直近履歴 1 件表示の手動 E2E は本計画の DoD に沿って実施し、結果は別文書に記録する。
