# 107 — Phase11-C 大賢者型・秘書人格OS 設計書

**目的**: 通常は人格を出さず、重要局面のみ「マスター」呼称を用いた事実ベースの最適行動提示を行う表示方針を定義する。

**前提**: 機能変更なし。表示文言のみを対象とする。

---

## 1. 人格設計書（思想・トーン・禁止事項）

### 1.1 人格の位置づけ

- **大賢者型**: 判断の要所で、選択肢と結果を簡潔に整理し、最適行動を提示する。説教や感情に訴えない。
- **秘書型**: 呼称は「マスター」に限定。主の意思決定を妨げず、情報と推奨だけを差し出す。

### 1.2 思想

- **主役はユーザー（マスター）である**: OS は補佐役。決定権は常にマスターにあり、システムは「事実」と「推奨」のみを提示する。
- **事実ベース**: 観測可能な状態・数値・条件に基づく記述のみ。憶測や感情表現は用いない。
- **最適行動の提示**: 「何をすべきか」ではなく「現状から導かれる推奨」を、理由とともに短く示す。押し付けない。

### 1.3 トーン

- **常時**: 中立・無人格。ラベル・ボタン・説明は機能説明に徹する（例: 「反映する」「状態を変更する」）。一人称・二人称は使わない。
- **重要局面のみ**: 二人称は「マスター」に統一。文は短く、体言止め・「です」「ます」を基本。敬語だが堅すぎない。

### 1.4 禁止事項

- **感情的トーンの禁止**: 喜び・心配・励まし・謝罪のニュアンスを出さない。例: 「ご心配なく」「申し訳ありません」「がんばって」は使わない。
- **人格の濫用**: 重要局面以外で「マスター」や人格的な言い回しを使わない。通常 UI は人格ゼロとする。
- **説教・押し付け**: 「すべき」「ねばならない」は使わない。推奨は「〜することを推奨します」程度に留める。
- **曖昧な主観**: 「きっと」「おそらく」は可とするが、根拠のない断定は避ける。

### 1.5 許容する表現

- 事実の提示: 「判断待ちが 3 件あります」「この項目は 60 分以上更新がありません」
- 推奨の提示: 「いまの状態から、『判断待ち』への変更を推奨します」
- 理由の簡潔な付与: 「期限が近いため」「滞留が長いため」
- マスター呼称: 重要局面のメッセージ内でのみ「マスター」を使用

---

## 2. 出現条件定義

### 2.1 「重要局面」の定義

人格（マスター呼称・秘書トーン）を出すのは、次のいずれかに該当するときのみとする。

| 条件 ID | 条件概要 | 判定の根拠（事実ベース） |
|---------|----------|---------------------------|
| C1 | 判断待ちの滞留 | 状態が NEEDS_DECISION の Node が N 件以上、または最古の更新から T 分経過 |
| C2 | 実施中の長期停滞 | 状態が IN_PROGRESS の Node のうち、更新が T 分以上ないものが 1 件以上 |
| C3 | 未着手の蓄積 | 状態が READY の Node が M 件以上 |
| C4 | エラー・失敗の直後 | 反映失敗・通信失敗・確認取得失敗など、ユーザー操作の結果が失敗だった直後 |
| C5 | 重要な確認ダイアログ直前 | 関係追加・グループ化・分解など、一度実行すると取り消しが難しい操作の確認前 |
| C6 | 履歴 0 件からの初回反映 | 反映した変更の履歴が 0 件の状態で、初めて「この変更を反映する」を押す直前 |
| C7 | 冷却中の再活性候補 | 状態が COOLING_DOWN の Node が一定数以上あり、再検討のタイミングとみなせる場合 |
| C8 | 日次・週次の要約タイミング | 所定時刻に「今日の判断待ち」「今週の完了」などの要約を表示する場合（将来拡張） |

※ N, M, T は運用で設定。例: N=3, M=5, T=60（分）。

### 2.2 非出現（人格を出さない）条件

- 通常の一覧表示・選択・タブ切替・生成ボタン押下
- 成功メッセージ（反映しました、適用しました）
- 読み込み中・空状態の案内（対象のノードがありません、まだ反映した変更はありません）
- 一般ラベル・ボタン・プレースホルダー

### 2.3 表示レイヤの分離

- **ベース UI 文言**: 既存の Phase11-A 文言。人格なし。
- **重要局面メッセージ**: 本設計の 1.1〜1.5 に従った短文。マスター呼称を使用する場合はここに限定。

実装時は「重要局面メッセージを表示するかどうか」を条件で切り、表示する場合のみ専用文言を表示する。

---

## 3. 重要局面メッセージ 50 例

いずれも「重要局面」で表示する短文の例。事実ベース・感情的トーン禁止・マスター呼称を守る。

### 3.1 判断待ち・滞留（C1）

1. マスター、判断待ちの項目が 3 件あります。いずれも 1 時間以上未更新です。
2. 判断待ちが 5 件に達しています。優先順位の確認を推奨します。
3. 最古の判断待ちは 24 時間前の更新です。放置による見落としに注意してください。
4. マスター、判断待ちのうち 1 件は子項目を持ちます。親から決めることを推奨します。
5. 判断待ちが 2 件、同一親の下にあります。まとめて選択して状態変更できます。

### 3.2 実施中・長期停滞（C2）

6. 実施中の項目のうち 1 件は 60 分以上更新がありません。再開または状態変更を推奨します。
7. マスター、実施中が 3 件あり、いずれも 2 時間以上更新なしです。
8. 実施中の「{タイトル}」は 24 時間更新がありません。中断扱いにするか、状態を更新してください。
9. 実施中が 1 件のみで、90 分以上更新なしです。いまの状態のままか、判断待ちへ移すかを選べます。
10. 長期停滞している実施中項目があります。詳細パネルから「何が起きた？」でメモを残せます。

### 3.3 未着手の蓄積（C3）

11. READY の項目が 5 件あります。着手順の検討を推奨します。
12. マスター、未着手の項目が 7 件に達しています。上位 3 件の選択を推奨します。
13. READY が 10 件を超えています。グループ化または分解で整理できます。
14. 未着手のうち 2 件は親項目が実施中です。子から着手するか、親の完了を待つかを決めてください。
15. READY が増加傾向にあります。構成案の生成で関係づけを確認できます。

### 3.4 エラー・失敗の直後（C4）

16. 反映に失敗しました。ネットワークと入力内容を確認し、再実行してください。
17. マスター、確認の取得に失敗しました。しばらく経ってから再度お試しください。
18. 通信に失敗しました。接続を確認のうえ、同じ操作をやり直してください。
19. ステータス変更に失敗しました。対象項目が存在するか、一覧の再読み込み後に再試行してください。
20. 反映は成功していますが、画面の更新に失敗しました。再読み込みで一覧を合わせてください。
21. 現在の状態が取得できていないため、反映できません。一覧を再読み込みしてから再度実行してください。
22. 対象の項目が見つかりません。一覧が更新されている可能性があります。再読み込みを推奨します。
23. 入力が不正です。UUID 形式の項目 ID を指定するか、未指定のまま絞り込んでください。
24. マスター、サーバー側で処理に失敗しました。時間をおいて再実行するか、操作を簡略化してください。
25. 履歴の取得に失敗しました。しばらく後に「反映した変更の履歴」を再表示してください。

### 3.5 重要な確認ダイアログ直前（C5）

26. この操作は取り消しできません。Node A と B の間に関係を 1 本追加します。実行してよろしいですか。
27. マスター、グループ化を実行すると、選択した項目は 1 つのグループにまとまります。よろしいですか。
28. 親項目の下に子を n 件作成して紐づけます。作成後も編集・削除は可能です。実行しますか。
29. 関係の追加は履歴に残り、後から参照できます。この内容で反映してよろしいですか。
30. 分解により新規項目が増えます。必要に応じて後から「反映した変更の履歴」で再表示できます。実行しますか。

### 3.6 初回反映・履歴周り（C6）

31. マスター、これが最初の反映になります。実行後は「反映した変更の履歴」で確認できます。
32. 初回の反映です。理由（任意）を入力すると、のちの履歴で参照しやすくなります。
33. まだ反映した変更はありません。この変更を反映すると、履歴の 1 件目として記録されます。
34. 履歴 0 件の状態での反映です。問題なければ「この変更を反映する」で実行してください。
35. 初回反映後は、同じ変更を「この変更を候補に再表示する」で再度適用できます。

### 3.7 冷却中・再検討（C7）

36. 冷却中の項目が 3 件あります。再検討のタイミングであれば、状態を「判断待ち」に戻せます。
37. マスター、冷却中が 1 件、48 時間経過しています。再開するか、完了・キャンセルにするかを選べます。
38. 冷却中の項目は一覧の「冷却中」で確認できます。必要に応じて状態を変更してください。
39. 冷却中が 5 件に達しています。一括で状態を更新するか、構成案で整理することを推奨します。
40. 冷却中の最古は 7 日以上前です。完了またはキャンセルにすると一覧がすっきりします。

### 3.8 要約・ナビゲーション（C8 想定）

41. 本日の判断待ちは 2 件です。実施中は 1 件、READY は 4 件です。
42. マスター、今週の完了は 5 件、キャンセルは 1 件です。履歴で理由を確認できます。
43. 現在、実施中 2 件・判断待ち 3 件・外部待ち 1 件です。優先度の高いものから処理を推奨します。
44. 判断待ちのうち 1 件は子項目を持ちます。親を先に処理すると、子の選択肢が明確になります。
45. 未着手が 5 件以上あります。構成案の「関係の追加」で依存関係を整理できます。

### 3.9 汎用・補足

46. マスター、操作を中断しても状態は保存されています。再読み込みで再開できます。
47. この内容で問題なければ、そのまま反映してください。誤りの場合はキャンセルを選んでください。
48. 事実に基づく推奨です。最終判断はマスターにお任せします。
49. 詳細は「反映した変更の履歴」または「関連する直近履歴」で確認できます。
50. 表示されている項目・状態はすべて保存済みです。次の操作を選んでください。

---

## 4. UI 統合方針

### 4.1 原則

- **既存ラベル・ボタンはそのまま**: Phase11-A で決めた「提案パネル」「構成案」「判断案」「反映する」「反映した変更の履歴」等は変更しない。
- **人格は「メッセージ」に限定**: 新規に表示する「重要局面メッセージ」のみ、1.1〜1.5 の人格ルールを適用する。
- **置き換えではなく追加**: 既存のエラーメッセージ（例: 「反映に失敗しました」）を削除せず、重要局面ではその前後に短い説明メッセージを**追加表示**するか、同一文脈で**置き換え**するかを実装フェーズで決める。

### 4.2 表示場所の候補

- **ダッシュボード上部**: 重要局面の条件を満たしたとき、トレー一覧の上に 1 行〜数行のメッセージを表示。
- **詳細パネル内**: 選択中の Node が C1/C2/C7 に該当する場合、詳細ブロックの下に 1 行の推奨メッセージを表示。
- **確認ダイアログの前または内**: C5 に該当する場合、確認文の直前に短い注意（例: 「この操作は取り消しできません」）を表示。または確認文そのものを 3.5 の例文に差し替え。
- **エラー表示の直後**: C4 に該当する場合、既存のエラーメッセージの下に、マスター呼称付きの短い補足（再実行の推奨等）を表示可能。

### 4.3 文言の管理方法

- **定数・メッセージマップ**: 重要局面メッセージは条件 ID とメッセージ ID で一意に参照できるようにし、文言は 1 か所で管理する（例: `phase11c_messages.ts` または設定 JSON）。
- **パラメータ挿入**: 「{タイトル}」「n 件」「T 分」等はプレースホルダで差し込み、実データで置換する。
- **多言語化は未対応**: 当面は日本語のみ。将来の多言語化時も、人格トーンは日本語を正とする。

### 4.4 実装時の注意

- 重要局面の**判定**は、既存の状態・履歴・エラー情報から算出する。新規 API は不要とする。
- 同一セッションで同じ条件が続く場合、メッセージの**重複表示・ spam 化**を避けるため、表示間隔や「すでに表示した条件」のフラグを検討する。
- 機能追加は行わないため、新規コンポーネントは「メッセージ表示用の 1 ブロック」程度に留め、既存レイアウトに差し込む形とする。

### 4.5 変更しないもの

- ナビゲーション・ルーティング・API・DB・状態機械の仕様
- ボタン・タブ・入力欄の挙動とラベル（Phase11-A 準拠）
- 成功時のトースト・メッセージ（人格を乗せない）

---

## 5. 成果物一覧

| # | 成果物 | 所在 |
|---|--------|------|
| 1 | 人格設計書（思想・トーン・禁止事項） | 本ドキュメント §1 |
| 2 | 出現条件定義 | 本ドキュメント §2 |
| 3 | 重要局面メッセージ 50 例 | 本ドキュメント §3 |
| 4 | UI 統合方針 | 本ドキュメント §4 |

実装フェーズでは、§2 の条件 ID と §3 の例文を紐づけ、§4 に従って表示箇所と文言管理を実装する。
