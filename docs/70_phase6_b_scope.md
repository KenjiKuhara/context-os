# 70 — Phase6-B スコープ（案）

Phase6-A 完了後の次の一歩として **Phase6-B** の目的とスコープを整理する。

**前提**: 68（Phase6-A 実装メモ）、69（Phase6-A closeout）。Phase5-A/B/C の Diff Apply と Phase6-A のツリー表示は維持する。

---

## 1. Phase6-B の目的

- **ツリー／一覧まわりを「見る」だけでなく「操作する」選択肢を増やす**、または **ツリー・親子関係の UX を一段上げる** ことを目的とする。
- Phase6-A は表示のみだったため、編集・並び替え・開閉の永続化などはすべて Phase6-B 以降の候補である。

---

## 2. Phase6-B の最初のテーマ

**Phase6-B の最初のテーマは「ツリーの開閉状態の永続化（expanded state persistence）」とする。**

- どのノードを開いていたか（expandedSet）を保存し、再読み込み・再訪問時に復元する。詳細な実装計画は 72_phase6_b_tree_state_persistence_plan.md に記載する。

**なぜ最初にこれをやるか**

- 開閉の永続化は **DB スキーマを変えずに** フロントの state と保存先（ローカル or サーバ）だけで完結できる。Phase6-A のツリー表示・キーボードナビを壊さずに小さく足せる。
- ユーザーは refresh や別ページからの戻りで「さっき開いていた枝」が閉じたままになるストレスが減り、**ツリーの利用頻度が上がる**。
- 実装が軽いため、Phase6-B の進め方（計画 doc → 実装 → 確認）を一度回すのに適している。その後に編集・並び替えなど重いテーマに進みやすくなる。

---

## 3. 想定するその他のテーマ（未確定）

以下は Phase6-B の 2 本目以降の候補であり、優先度・実施順は未定である。

| テーマ | 概要 |
|--------|------|
| **ツリー上でのノード編集** | ツリー行からタイトルやコンテキストを編集。既存の詳細パネルとの役割分担を決める必要あり。 |
| **ドラッグで並び替え・親変更** | 子の順序（sibling_order）変更や、ノードを別の親の下に移動。node_children と nodes.parent_id の整合をどう取るか。 |
| **深さ制限の拡張** | 5 階層超の表示オプション、または「さらに表示」で遅延展開。 |
| **ツリーとトレーの統合表示** | トレー別にツリーを分ける、またはツリーとトレーを横断するナビ・フィルタ。 |
| **その他** | 検索・ハイライト、ツリーのコンテキストメニューなど。 |

---

## 4. 今はやらないこと

Phase6-B を始める前、または「Phase6-B では扱わない」と明示するもの。

| 項目 | 内容 |
|------|------|
| **Phase5 の変更** | relation / grouping / decomposition の Diff Apply フロー・API は触らない。 |
| **Phase6-A の破壊** | フラット／ツリー切替、開閉、キーボードナビ、詳細パネル連携は維持する。 |
| **DB スキーマの不用意な変更** | nodes / node_children の構造は変えず、必要なら別 doc で設計してから migration。 |
| **一括・自動操作** | 「全ノードを閉じる」「ツリーを全部展開」などは Phase6-B のスコープに入れるか別途決める。 |

---

## 5. 進め方

- 最初のテーマ（開閉状態の永続化）の実装計画は **72_phase6_b_tree_state_persistence_plan.md** に記載する。
- 2 本目以降のテーマが決まったら、本ドキュメントを更新するか、73 以降の計画 doc を新規作成する。
- 実装前にスコープ・DoD・ファイル一覧を 1 本の doc にまとめる形式は、Phase5-B/5-C と同様とする。

---

以上。Phase6-B の目的と最初のテーマ（開閉状態の永続化）を確定した。詳細は 72 を参照する。
