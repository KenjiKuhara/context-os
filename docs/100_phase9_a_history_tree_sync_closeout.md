# 100 — Phase9-A 履歴クリック時のツリー連動 MVP クローズアウト

**Phase9-A（履歴クリック時のツリー連動）を「完了」として正式にクローズする。**

**参照**: 97_phase9_a_history_tree_sync_design.md、98_phase9_a_history_tree_sync_e2e_plan.md、99_phase9_a_history_tree_sync_e2e_result.md。

---

## 1. 完了宣言

- **Phase9-A（履歴クリック時のツリー連動）はクローズした。**
- 履歴 1 件をクリックしたときに、該当 node_id をツリーで自動展開・ハイライト・詳細表示する。DB 変更・API 変更は行わず、ProposalPanel の `onHistoryItemSelect` と Dashboard の highlight 状態・展開処理・TreeList の `highlightIds` のみで実現している。
- 99 にて手動 E2E を実施し、DoD 全項目および影響なし確認を満たしたことを確認したうえで、本クローズとする。

---

## 2. できるようになったこと

| 項目 | 内容 |
|------|------|
| **履歴クリック時のツリー自動展開** | Organizer タブの「履歴」で relation / grouping / decomposition の 1 件をクリックすると、該当ノードまでの経路がツリー上で自動展開される（expandedSet に祖先を追加）。 |
| **履歴関連ノードのハイライト** | クリックした履歴に含まれる node_ids がツリー上で背景色でハイライトされ、どのノードがその履歴に関係するか一目で分かる。 |
| **代表ノードの詳細表示** | 履歴の primaryNodeId（relation なら from、grouping なら node_ids[0]、decomposition なら parent）が右詳細パネルに表示される。 |
| **ハイライトのクリア** | ツリーまたはフラット一覧で別ノードをクリックするとハイライトが消え、選択に集中できる。 |
| **フラット表示時の連動** | フラット表示時は展開は行わず、詳細パネルの更新と一覧行のハイライトのみ行う。 |

---

## 3. DoD 確認表

| # | 確認項目（98 §2 相当） | 結果 |
|---|------------------------|------|
| 1 | relation 履歴クリック（ツリー表示時）→ 経路展開・2 ノードハイライト・詳細に from 表示 | ✅ |
| 2 | grouping 履歴クリック（ツリー表示時）→ 経路展開・該当ノードハイライト・詳細に先頭ノード表示 | ✅ |
| 3 | decomposition 履歴クリック（ツリー表示時）→ 親までの経路展開・親ハイライト・詳細に親表示 | ✅ |
| 4 | ツリーで別ノードをクリック → ハイライトが消え、クリックしたノードが詳細表示される | ✅ |
| 5 | フラット表示時の履歴クリック → 展開なし・詳細更新・一覧行ハイライト・別ノードクリックでクリア | ✅ |
| 6 | status_change 履歴は連動しない（履歴詳細表示のみ） | ✅ |

---

## 4. 本 MVP で行わないこと（割り切り）

以下は Phase9-A の範囲外であり、クローズ時点で一切行わない。（97 §6 を踏襲）

| 項目 | 内容 |
|------|------|
| **複数件同時選択** | 履歴から「複数件」を同時に選択してツリー連動することは行わない（常に 1 件クリック）。 |
| **status_change** | status_change の履歴は対象外（ツリー連動しない）。 |
| **存在しない node_id** | ツリーに存在しない node_id（別トレーや削除済み）への「代替表示」や API 追加は行わない。その場合は詳細表示のみスキップするなど、フロントで扱える範囲のみとする。 |
| **アニメーション・スクロール** | ハイライトの「アニメーション」や「スクロールして見せる」は MVP では必須としない。 |

---

## 5. 影響なし確認

| 項目 | 確認内容 | 結果（99 §5） |
|------|----------|----------------|
| **Phase6 ツリー操作** | /dashboard でツリー表示にし、手動で開閉・キーボード（→←↑↓）・詳細パネル選択を行う。従来どおり動作する。履歴未クリック時もハイライトは出ない。 | ✅ 壊れていない |
| **Phase7-8 履歴・復元** | 履歴一覧の表示・詳細表示・フィルタ・「この変更内容をApply候補として再表示する」で復元する。従来どおり動作する。履歴クリックでツリー連動するが、履歴タブの選択・詳細・復元 UI は壊れていない。 | ✅ 壊れていない |
| **Phase7-8 Apply** | Organizer の適用可能 Diff から「このDiffを反映する」で Apply、または復元した Apply 候補から Apply する。従来どおり成功する。 | ✅ 壊れていない |

99 の手動 E2E にて上記を確認した。

---

## 6. 参照ドキュメント

| 番号 | ファイル名 |
|------|------------|
| 97 | 97_phase9_a_history_tree_sync_design.md |
| 98 | 98_phase9_a_history_tree_sync_e2e_plan.md |
| 99 | 99_phase9_a_history_tree_sync_e2e_result.md |

---

以上をもって Phase9-A 履歴クリック時のツリー連動 MVP をクローズする。
