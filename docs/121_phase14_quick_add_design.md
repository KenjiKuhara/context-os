# 121 — Phase14-QuickAdd 設計

目的は**「構造」ではなく「速度」**。  
「思考が浮かんだ瞬間に、マウスなしで即タスクを追加できる体験」を完成させる。

**参照**: docs/114_phase_status.md、POST /api/nodes（既存）。

---

## §1 なぜ必要か（速度に集中）

思考 OS として、**思いついたことをすぐ放り込めない**のは致命的である。

- 本 Phase の目的は**速度**であり、構造（親子・タグ・AI 補助等）は一切扱わない。
- 1 行 input で **Enter で即追加 → フォーカス維持 → 連続追加** が成立すれば、この体験で DONE とする。

---

## §2 完了条件（この 5 つだけ）

Phase14 の完了条件は以下の**5 項目のみ**。この体験が完成したら **DONE** とする。

| # | 完了条件 |
|---|----------|
| 1 | **連続 10 件をマウスなしで追加可能** |
| 2 | **Enter で即追加** |
| 3 | **追加後フォーカス維持** |
| 4 | **API 待ちで UI が止まらない（optimistic）** |
| 5 | **Esc で即クリア** |

**範囲外（一切追加しない）**: 構造・親子・タグ・AI 補助。**UI は 1 行 input のみ。**

---

## §3 UI 案（3 案比較）

| 案 | 概要 | メリット | デメリット |
|----|------|----------|------------|
| **A** | **画面上部固定インライン入力** | 常に同じ場所にあり、マウス不要。フォーカスを当てるだけで入力開始。追加後もフォーカス維持が自然。実装が最小。 | ヘッダ付近の縦スペースを常に使う。 |
| **B** | **⌘/Ctrl + K クイックコマンド型** | 画面を占有しない。他機能と統一感が出る。 | ショートカットを押すステップが増え、1 秒以内が難しくなる。モーダル開閉の実装が増える。 |
| **C** | **右下フローティング＋ショートカット** | 目立つ。 | マウスでクリックする前提になりがち。フローティングの z-index・レスポンス考慮が必要。 |

**MVP 採用案**: **A（画面上部固定インライン入力）**

- マウス移動なし・Enter 確定・追加後フォーカス維持を満たすのに最も直截。
- 実装範囲が最小で、既存 page のレイアウトに 1 行足す形に収まる。
- 1 秒以内での追加と連続追加の両方を満たしやすい。

---

## §4 実装方針

- **UI**: **1 行 input のみ**。placeholder は短く（例:「タスクを追加…」）。ボタンなし。Enter で送信。
- **配置**: dashboard の `page.tsx` において、タイトル直下などに QuickAdd 用の 1 行入力欄を配置する。
- **API**: 既存の **POST /api/nodes** をそのまま利用。送信 body: `{ title: string, status: "READY", parent_id: null }`。作成後に `refreshDashboard` で一覧を更新。
- **追加しない**: 構造・親子・タグ・AI 補助は一切追加しない。既存文言・既存ロジックは変更しない。

---

## §5 完了ゲート（§2 と同じ 5 項目）

この 5 つを満たした時点で **DONE** とする。

| # | ゲート | 確認内容 |
|---|--------|----------|
| (1) | 連続 10 件をマウスなしで追加可能 | 入力→Enter を 10 回連続でマウスなしで行え、すべて一覧に反映されること。 |
| (2) | Enter で即追加 | Enter を押すとその時点のテキストでノードが追加されること。 |
| (3) | 追加後フォーカス維持 | 1 件追加後も入力欄にフォーカスが残り、続けて入力できること。 |
| (4) | API 待ちで UI が止まらない（optimistic） | 送信直後に仮反映し、API 完了を待たずに次の入力ができること。失敗時のみ巻き戻す。 |
| (5) | Esc で即クリア | Esc で入力内容が即クリアされること。 |

---

## §6 実装制約（速度を保証するため）

| # | 制約 | 理由・補足 |
|---|------|------------|
| 1 | **入力欄は初期表示時に自動フォーカスしない** | 誤入力防止。 |
| 2 | **Enter で即追加** | 確定は Enter のみ。API 待ちでブロックしない（optimistic）。 |
| 3 | **追加後フォーカス維持** | 連続入力可能にする。 |
| 4 | **Esc で即クリア** | 入力内容を即クリア。 |
| 5 | **placeholder は短く** | 例:「タスクを追加…」。 |
| 6 | **UI は 1 行 input のみ** | textarea 禁止。構造・親子・タグ・AI 補助は追加しない。 |

---

## §7 実装手順

| Step | 内容 | 完了条件 |
|------|------|----------|
| **Step1** | QuickAdd コンポーネント追加（UI のみ、API 未接続） | 1 行 input + 短い placeholder が表示され、テーマに追従すること。 |
| **Step2** | POST 接続（まずは同期） | Enter で POST /api/nodes を呼び、成功時に refreshDashboard で一覧を更新すること。 |
| **Step3** | optimistic UI | 送信直後に仮反映し、API 待ちで UI を止めない。失敗時のみ巻き戻す。 |
| **Step4** | フォーカス維持・Esc クリア | 追加後もフォーカス維持。Esc で即クリア。 |
| **Step5** | ゲート確認 | §5 の (1)〜(5) を満たしたら DONE とする。 |

---

## §8 完了時出力形式

Phase14 実装完了後、以下 4 点を出力する。

1. **実装ステップ完了報告**: Step1〜Step5 のそれぞれを完了したか（✅/要対応）と、実施した内容の要約。
2. **体感速度レポート**: 連続 10 件追加の体感時間、1 件あたりの体感が 1 秒以内か、optimistic による待ち感の有無。
3. **問題点**: 検証で見つかった不具合・違和感・制約上のギャップ（なしの場合は「特になし」）。
4. **改善要否判断**: 現時点で追加の改善が必要か（不要／軽微のみ／要 Phase 追加）と、その理由。

---

## 参照ドキュメント

| 番号 | ファイル名 |
|------|------------|
| 114 | 114_phase_status.md |
| - | POST /api/nodes（src/app/api/nodes/route.ts） |

---

**要約**: 目的は**速度**。完了条件は「連続 10 件マウスなし・Enter 即追加・フォーカス維持・optimistic・Esc 即クリア」の 5 つのみ。構造・親子・タグ・AI は一切追加しない。UI は 1 行 input のみ。この体験が完成したら DONE とする。
