# 98 — Phase9-A 履歴クリック時のツリー連動 手動 E2E 計画

Phase9-A（履歴 1 件クリック時に該当 node_id をツリーで自動展開・ハイライト・詳細表示する）を手動 E2E で検証するための計画。DoD チェックリストと影響なし確認を整理する。

**参照**: 97_phase9_a_history_tree_sync_design.md、[ProposalPanel.tsx](src/components/ProposalPanel.tsx)、[src/app/dashboard/page.tsx](src/app/dashboard/page.tsx)、[TreeList.tsx](src/components/TreeList.tsx)。

---

## 1. 対象

Phase9-A で追加した以下を手動 E2E で確認する。DB・API 変更は行っていない。

| 項目 | 内容 |
|------|------|
| **履歴クリック時のツリー連動** | Organizer タブの「履歴」で relation / grouping / decomposition の 1 件をクリックしたとき、ツリー表示なら該当ノードまでの経路を自動展開し、該当ノードをハイライトし、代表ノードの詳細を右パネルに表示する。 |
| **ハイライトのクリア** | ツリーまたはフラット一覧で別ノードをクリックすると、ハイライトが消える。 |
| **フラット表示時** | フラット表示のときは展開は行わず、詳細表示の更新と一覧行のハイライトのみ行う。 |

---

## 2. DoD（手動 E2E チェックリスト）

| # | 確認項目 | 手順・期待結果 |
|---|----------|----------------|
| 1 | **relation 履歴クリック（ツリー表示時）** | 一覧をツリー表示にし、relation の履歴 1 件をクリックする。→ from_node_id / to_node_id が現在のトレーに含まれる場合、該当ノードまでの経路が展開され、該当 2 ノードがハイライト（背景色）され、右詳細パネルに from_node_id のノードが表示される。 |
| 2 | **grouping 履歴クリック（ツリー表示時）** | grouping の履歴 1 件をクリックする。→ node_ids に含まれるノードまでの経路が展開され、該当ノードがハイライトされ、詳細パネルに node_ids の先頭ノードが表示される。 |
| 3 | **decomposition 履歴クリック（ツリー表示時）** | decomposition の履歴 1 件をクリックする。→ parent_node_id までの経路が展開され、親ノードがハイライトされ、詳細パネルに親ノードが表示される。 |
| 4 | **ツリーで別ノードをクリック** | 履歴クリックでハイライトが付いた状態で、ツリーの別ノードをクリックする。→ ハイライトが消え、クリックしたノードが詳細表示される。 |
| 5 | **フラット表示時の履歴クリック** | 一覧をフラット表示にし、relation / grouping / decomposition の履歴 1 件をクリックする。→ 展開は行われない。詳細パネルに primary ノードが表示され、左一覧で該当ノード行がハイライトされる。別ノード行をクリックするとハイライトが消える。 |
| 6 | **status_change 履歴は連動しない** | status_change の履歴 1 件をクリックする。→ ツリーの展開・ハイライト・詳細パネルの連動は起きない（履歴詳細表示のみ）。 |

---

## 3. 影響なし確認

手動 E2E で以下を簡易確認する。

| 項目 | 確認内容 | 期待結果 |
|------|----------|----------|
| **Phase6 ツリー操作** | /dashboard でツリー表示にし、手動で開閉・キーボード（→←↑↓）・詳細パネル選択を行う。 | 従来どおり動作する。履歴未クリック時もハイライトは出ない。 |
| **Phase7-8 履歴・復元** | 履歴一覧の表示・詳細表示・フィルタ・「この変更内容をApply候補として再表示する」で復元する。 | 従来どおり動作する。履歴クリックでツリー連動するが、履歴タブの選択・詳細・復元 UI は壊れていない。 |
| **Phase7-8 Apply** | Organizer の適用可能 Diff から「このDiffを反映する」で Apply、または復元した Apply 候補から Apply する。 | 従来どおり成功する。 |

---

## 4. 本 MVP で行わないこと（割り切り）

以下は Phase9-A の範囲外であり、一切行わない。

| 項目 | 内容 |
|------|------|
| **複数件同時選択** | 履歴から「複数件」を同時に選択してツリー連動することは行わない（常に 1 件クリック）。 |
| **status_change** | status_change の履歴は対象外（ツリー連動しない）。 |
| **存在しない node_id** | ツリーに存在しない node_id（別トレーや削除済み）への「代替表示」や API 追加は行わない。その場合は詳細表示のみスキップするなど、フロントで扱える範囲のみとする。 |
| **アニメーション・スクロール** | ハイライトの「アニメーション」や「スクロールして見せる」は MVP では必須としない。 |

---

## 5. 参照ドキュメント

| 番号 | ファイル名 |
|------|------------|
| 97 | 97_phase9_a_history_tree_sync_design.md |

---

以上。Phase9-A 履歴クリック時のツリー連動の手動 E2E は本計画の DoD に沿って実施し、結果は別文書に記録する。
