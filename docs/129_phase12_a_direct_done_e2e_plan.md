# 129 — Phase12-A：直接完了遷移 E2E 計画

128 設計書 §5 に基づく手動 E2E の実施計画。最小実装後の確認用。

**参照**: docs/128_phase12_a_direct_done_design.md、docs/114_phase_status.md。

---

## 1. 観点

- 直接完了遷移が「全非終了状態から」許可されること。
- 履歴が通常どおり記録されること。
- 既存の「中止」と終了状態からの遷移が壊れていないこと。
- UI で「完了」が現在状態でない限り常に押せること。
- **更新中は全状態ボタンが非活性になり、更新中はエラーメッセージを表示しないこと。**

---

## 2. シナリオ一覧

| # | シナリオ | 手順 | 期待結果 |
|---|----------|------|----------|
| E1 | 捕捉 → 完了 | 状態「捕捉」のノードを開き、「完了」をクリック | 状態が「完了」に変わる。履歴に from=CAPTURED, to=DONE が記録される。 |
| E2 | 外部待ち → 完了 | 状態「外部待ち」のノードを開き、「完了」をクリック | 状態が「完了」に変わる。エラーが出ない。 |
| E3 | 障害あり → 完了 | 状態「障害あり」のノードを開き、「完了」をクリック | 状態が「完了」に変わる。 |
| E4 | 休眠 → 完了 | 状態「休眠」のノードを開き、「完了」をクリック | 状態が「完了」に変わる（直接完了の例外で許可）。 |
| E5 | 完了のボタンは非活性 | 状態が既に「完了」のノードを開く | 「完了」ボタンが active＋disabled で、再押下できない。 |
| E6 | 中止は従来どおり | 任意の非終了状態のノードで「中止」をクリック | 従来どおり「中止」に遷移する。 |
| E7 | 完了 → 再浮上のみ | 状態「完了」のノードを開く | 「完了」以外で押せるのは「再浮上」のみ。 |
| E8 | 履歴の整合 | 完了遷移後、ステータス・メモログまたは履歴で確認 | node_status_history に from_status / to_status / reason 等が記録されている。 |
| E9 | 更新中は全ボタン非活性 | 任意のノードで「完了」をクリックし、API 応答が返るまでの間を観察 | クリック直後から応答まで、全状態ボタンが非活性。更新中にエラーメッセージは表示されない。 |

---

## 3. 実行方法・完了条件

- 手動 E2E で実施する。
- 上記 E1〜E9 を実施し、すべて期待結果を満たしたら Phase12-A の E2E 合格とする。
- 結果は 130_phase12_a_direct_done_e2e_result.md に記録する。

---

## 参照

| 番号 | ファイル名 |
|------|------------|
| 128 | 128_phase12_a_direct_done_design.md |
| 114 | 114_phase_status.md |

以上。Phase12-A 直接完了遷移の E2E 計画とする。
