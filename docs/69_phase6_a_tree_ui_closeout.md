# 69 — Phase6-A ツリー可視化（UI）クローズアウト

**Phase6-A MVP（ツリー可視化）を「完了」として正式にクローズする。** 手順・実装メモは 68 を参照する。本ドキュメントはプロジェクト管理上の区切りとしての終了札とする。

---

## 1. 完了宣言

- **Phase6-A MVP（ツリー可視化 UI）は完了した。**
- decomposition で作った親子構造（nodes.parent_id + node_children）を /dashboard の一覧でツリー表示できる。表示切替（フラット / ツリー）、開閉、キーボードナビ（→←↑↓）、詳細パネル連携まで実装済み。Phase5-A/B/C の Diff Apply は変更していない。

---

## 2. できるようになったこと

| 項目 | 内容 |
|------|------|
| **API** | GET /api/dashboard のレスポンスに `node_children`（parent_id, child_id, created_at）を追加。 |
| **ツリー構築** | フロントで `buildTree(nodes, node_children)` により表示順の TreeNode を生成。node_children 優先・parent_id は fallback。循環検知・深さ 5 まで。 |
| **表示** | 一覧で「フラット / ツリー」切替。ツリー時は親をルートに、子をインデント＋ガイド線で表示。開閉（▶/▼）、子件数表示。 |
| **詳細連携** | 行クリックで右側の詳細パネルにそのノードを表示（従来どおり）。 |
| **キーボード** | ツリー領域フォーカス時のみ。→ で展開＋先頭子を選択。← で子のときは親を閉じて親を選択、親のときはサブツリー全体を閉じて選択はそのまま。↑↓ で表示順に前後のノードを選択。input/textarea 内では無視。 |
| **エラー時** | API 失敗時は既存のエラーメッセージ表示。ツリー用 state は初期値で崩れない。 |

---

## 3. MVP としての割り切り

以下は Phase6-A の範囲外であり、クローズ時点で未対応である。

| 項目 | 内容 |
|------|------|
| **編集** | ツリー上でのノード編集（タイトル変更・削除）は行わない。 |
| **ドラッグ** | ドラッグ＆ドロップでの並び替え・親変更は行わない。 |
| **Undo** | 開閉状態の Undo やツリー操作の取り消しは行わない。 |
| **並び替え** | sibling_order や表示順の変更 UI は行わない。表示順は buildTree の結果（DB の親子関係）のまま。 |
| **深さ 5 超** | 5 階層より深い部分は表示しない（無限ループ防止）。 |
| **フラット時の矢印** | フラット表示時は矢印キーは効かない（ツリーコンポーネントがマウントされないため）。 |

---

## 4. 次フェーズへの引き継ぎ

Phase6-B またはその先で検討しうるテーマを以下に挙げる。

| 候補 | 内容 |
|------|------|
| **ツリー上の編集** | ノードのリネーム・削除・親変更をツリー UI から行う。 |
| **ドラッグで並び替え** | 子の順序変更（sibling_order 更新）や親の付け替え。 |
| **開閉状態の永続化** | どのノードを開いていたかを localStorage 等で保持し、再表示時に復元する。 |
| **深さ制限の緩和** | 5 階層を超えるツリーの表示オプションや遅延展開。 |
| **ツリーとトレーの統合** | トレー（実施中・判断待ち等）ごとにツリーを分ける表示や、ツリーとトレーを横断するナビ。 |

---

**以上をもって Phase6-A ツリー可視化 MVP をクローズする。**
