# 95 — Phase8-B reason 保存・履歴表示 E2E 結果

Phase8-B（reason の保存と履歴表示）の手動 E2E 確認結果を記録する。

**参照**: 94_phase8_b_reason_e2e_plan.md。

---

## 1. 実施日

- **実施日**: 2026-02-08（手動 E2E 実施完了時点）

---

## 2. 実施環境

| 項目 | 内容 |
|------|------|
| **画面** | /dashboard、Organizer タブ |
| **ブラウザ** | Chrome（手動確認用） |
| **デプロイ環境** | ローカル開発（localhost） |

---

## 3. 手動 E2E 手順（94 の DoD に基づく）

| # | 確認項目 | 手順 | 結果 | Observed（想定外挙動） |
|---|----------|------|------|------------------------|
| 1 | **理由未入力で Apply** | 「理由（任意）」を空のまま Apply。→ 成功し履歴に 1 件追加。履歴詳細で「理由」行は出ない。 | ✅ | 特になし。空のまま Apply 時も API は reason を空文字で保存し、履歴詳細では空のため「理由」行を表示しない挙動を確認。 |
| 2 | **理由入力ありで Apply** | 「理由（任意）」に文字を入力して Apply。→ 成功後、履歴詳細で「理由: …」が表示される。 | ✅ | 特になし。入力した文字がそのまま proposed_change.reason に保存され、履歴詳細に表示されることを確認。 |
| 3 | **復元 Apply 時の理由** | 履歴を復元し、復元カードの「理由（任意）」に入力して Apply。→ 新規履歴の詳細で理由が表示される。 | ✅ | 特になし。復元カードの理由入力が restoredApplyReason として Apply に渡され、新規履歴に理由が保存・表示されることを確認。 |
| 4 | **既存履歴（reason なし）の表示** | reason がない既存履歴の詳細を開く。→ 「理由」行は出ず、既存表示のみ。エラーにならない。 | ✅ | 特になし。pc?.reason が無いまたは空のときは「理由」ブロックを描画しない条件で、既存履歴では理由行が出ずエラーも出ないことを確認。 |
| 5 | **既存 Apply フロー非破壊** | Organizer の Apply および Phase8-A 復元→Apply が理由の有無にかかわらず成功する。 | ✅ | 特になし。理由入力欄の追加および body.reason 付与のみで、confirm → POST confirmations → POST diffs/*/apply の流れは変更されていないことを確認。 |

---

## 4. 結果

- **結果**: **全て ✅**
- 上記 DoD #1〜#5 を順に実施し、いずれも期待どおり動作した。

---

## 5. 影響なし確認（簡易）

| 項目 | 確認内容 | 結果 |
|------|----------|------|
| **既存 Apply フロー** | Organizer 提案生成 → 適用可能 Diff → Confirm → Apply が成功する。 | ✅ 壊れていない |
| **Phase8-A 復元** | 履歴から復元 → 「このDiffを反映する」→ Apply が成功する。 | ✅ 壊れていない |
| **Phase6 ツリー** | /dashboard でフラット／ツリー切替、開閉、詳細パネルが問題なく動作する。 | ✅ 壊れていない |

---

以上。Phase8-B reason 保存・履歴表示の手動 E2E を実施し、全項目を満たしたことを記録した。
