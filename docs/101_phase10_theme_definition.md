# 101 — Phase10 テーマ定義

Phase9-A クローズ後の到達点を踏まえ、Phase10 で取り組むテーマを 1 つ選定し定義する。

**条件**: MVP として成立する／既存を壊さない／DB 変更は原則なし／OS の価値を 1 段上げる／拡張はしない／視覚的わかりやすさ or 意思決定の質向上のどちらかに寄与する。

---

## 1. 現在の到達点整理

| フェーズ | 到達点 |
|----------|--------|
| **Phase6** | ツリー表示・フラット切替、開閉永続化（localStorage）、キーボード操作、詳細パネル連携。Organizer / Advisor / 適用可能 Diff の Apply。 |
| **Phase7** | 適用済み Diff 履歴の可視化（API・一覧・詳細）、Apply 後のリロード不要更新。履歴の type / node_id フィルタ UI。 |
| **Phase8-A** | 履歴から「この変更内容をApply候補として再表示する」で復元し、復元カードから既存 Apply フローで適用可能。 |
| **Phase8-B** | Apply 時の「理由（任意）」入力と proposed_change.reason の保存。履歴詳細で reason を表示。 |
| **Phase9-A** | 履歴 1 件クリック時に該当 node_id をツリーで自動展開・ハイライト・詳細表示。別ノードクリックでハイライトクリア。フラット時は詳細更新と一覧行ハイライトのみ。 |

**まとめ**: 「意思決定を辿れる OS」として、履歴の一覧・詳細・フィルタ・復元・理由表示まで実装済み。Phase9-A で「履歴→ノード」の連携（ツリー展開・ハイライト・詳細）が完了している。

---

## 2. 候補テーマ（3 つ）

| 記号 | テーマ | 概要 |
|------|--------|------|
| **A** | **ノード詳細に「このノードに関係する直近履歴」を 1 件表示** | 右詳細パネルでノードを選択したとき、その node_id に関係する直近 1 件の履歴（種別・日時・要約・理由の有無）を表示する。Phase9-A の「履歴→ノード」の逆方向で、「ノード→履歴」のつながりを足す。 |
| **B** | **履歴一覧に理由（reason）のプレビュー表示** | 履歴一覧の各行に、reason が存在する場合のみ先頭 N 文字（例: 20 文字）をプレビュー表示する。詳細を開かずに「なぜ」を一覧で追いやすくする。 |
| **C** | **Observer 提案対象ノードをツリー/一覧でハイライト** | Observer の suggested_next や status_proposals の対象 node_id を、ダッシュボード左のツリー（またはフラット一覧）でハイライト表示する。Observer パネルと「どこに注目すべきか」を一致させる。 |

---

## 3. 比較表（価値 / 難易度 / 既存影響）

| 候補 | 価値 | 難易度 | 既存影響 |
|------|------|--------|----------|
| **A** | ノードを選んだ瞬間に「このノードに直近何をしたか」が分かる。ツリーと履歴の双方向のつながりが揃い、**意思決定の質**が上がる。 | 低。既存 GET /api/confirmations/history は node_id クエリ対応済み。詳細パネルに 1 ブロック追加し、limit=1 で 1 件取得・表示するだけ。 | 詳細パネルに「関連する直近履歴」ブロックを 1 つ追加するのみ。既存ノード詳細・ツリー・履歴タブは変更しない。 |
| **B** | 一覧で「なぜ」が追える。**意思決定の質**向上。 | 低。reason は既に履歴 API で返る。フロントの一覧行表示を拡張するだけ。 | 履歴一覧の行に 1 行（または短いテキスト）追加するのみ。既存詳細・フィルタ・復元は変更しない。 |
| **C** | Observer の提案とツリー上の「どこか」が対応し、**視覚的わかりやすさ**が上がる。 | 中。Observer 報告から node_id を取出し、既存の highlight 機構（Phase9-A）と同様に Dashboard でハイライトする。報告の構造に依存する。 | ダッシュボードで Observer 報告取得後に highlightNodeIds を設定する連携を追加。ツリー/一覧は既存の highlight 表示を流用。 |

---

## 4. 最終選定（1 つ）

**候補 A: ノード詳細に「このノードに関係する直近履歴」を 1 件表示** を Phase10 のテーマとする。

---

## 5. なぜそれなのか

| 観点 | 理由 |
|------|------|
| **OS の価値** | Phase9-A で「履歴→ノード」は実装済み。その逆「ノード→履歴」を足すことで、**ツリーと履歴の双方向のつながり**が揃い、「意思決定を辿れる OS」が 1 段進む。 |
| **MVP として成立** | 表示は「直近 1 件」に限定する。既存の履歴 API（node_id クエリ・limit）のみで実装可能。スコープが明確。 |
| **既存を壊さない** | 詳細パネルに 1 ブロック追加するだけ。DB 変更なし。API の仕様変更なし（既存の読み取りのみ利用）。 |
| **難易度** | 低。取得・表示の追加のみで、Phase9-A の履歴連動より変更範囲が小さい。 |
| **寄与** | **意思決定の質**の向上（このノードに直近何をしたかが、詳細を開く前に分かる）。 |

---

## 6. やること / やらないこと

### やること

- ノード詳細パネル（右側）に「このノードに関係する直近履歴」ブロックを 1 つ追加する。
- 表示時に対象ノードの node_id で GET /api/confirmations/history?node_id=...&limit=1 を呼び、取得した 1 件を表示する（日時・種別・要約。reason があれば表示）。
- 該当する履歴が 0 件のときは「該当する履歴はありません」等の短いメッセージを表示する。

### やらないこと

- 複数件表示・ページネーションは行わない（直近 1 件のみ）。
- 履歴の編集・削除は行わない。
- DB のスキーマ変更・新規 API の追加は行わない（既存の GET /api/confirmations/history の利用のみ）。
- 履歴タブの一覧・詳細・フィルタ・復元・Phase9-A の履歴→ツリー連動は変更しない。
- Observer との連携・Observer 報告の表示変更は Phase10 の範囲外とする。

---

## 7. 次の実装フェーズ名

**Phase10-A**（ノード詳細に関連する直近履歴 1 件表示）

---

以上。Phase10 のテーマを「ノード詳細に関連する直近履歴 1 件表示」と定義し、Phase10-A として実装する。
